- name: Pip freeze docker-compose
  ansible.builtin.shell: pip freeze | grep docker-compose
  changed_when: false
  failed_when: false
  register: pip_freeze_dc

- name: Remove docker compose binary (when not pip package)
  ansible.builtin.file:
    path: /usr/local/bin/docker-compose
    state: absent
  when: pip_freeze_dc.stdout_lines | length == 0
  register: remove_docker_compose

- name: Remove old conflicting packages
  ansible.builtin.apt:
    pkg:
      - docker.io
      - docker-compose
      - docker-doc
      - podman-docker
      - containerd
      - runc
    state: absent
  when: (ansible_distribution == 'Ubuntu')